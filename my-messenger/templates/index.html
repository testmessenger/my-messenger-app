<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Messenger</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <style>
        body { background: #0e1621; color: white; font-family: -apple-system, blinkmacsystemfont, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { background: #182533; padding: 10px 15px; border-radius: 12px; position: relative; max-width: 80%; width: fit-content; animation: fadeIn 0.2s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .msg b { color: #5288c1; font-size: 0.9em; display: block; margin-bottom: 4px; }
        .msg img, .msg video { max-width: 100%; border-radius: 8px; margin-top: 5px; display: block; }
        .del-btn { color: #ef5350; font-size: 11px; cursor: pointer; margin-left: 10px; opacity: 0.6; }
        .del-btn:hover { opacity: 1; }
        #input-area { background: #17212b; padding: 15px; display: flex; align-items: center; gap: 12px; }
        input[type="text"] { flex: 1; background: #242f3d; border: none; color: white; padding: 12px; border-radius: 10px; outline: none; }
        .btn-ui { cursor: pointer; color: #6ab3f3; font-size: 24px; user-select: none; }
    </style>
</head>
<body>
    <div id="chat"></div>
    <div id="input-area">
        <label class="btn-ui">üìé<input type="file" id="file-input" style="display:none" onchange="uploadFile()"></label>
        <input type="text" id="text-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter') sendText()">
        <div class="btn-ui" onclick="sendText()">‚û§</div>
    </div>

    <script>
        const socket = io();
        const myName = "User_" + Math.floor(Math.random() * 1000);

        function sendText() {
            const el = document.getElementById('text-input');
            if(el.value.trim()) {
                socket.emit('message', { user: myName, type: 'text', content: el.value });
                el.value = '';
            }
        }

        function uploadFile() {
            const file = document.getElementById('file-input').files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                let type = 'file';
                if (file.type.startsWith('image/')) type = 'image';
                else if (file.type.startsWith('video/')) type = 'video';
                
                socket.emit('message', {
                    user: myName,
                    type: type,
                    content: e.target.result,
                    filename: file.name
                });
            };
            reader.readAsDataURL(file);
        }

        socket.on('render_message', function(data) {
            const chat = document.getElementById('chat');
            let html = `<div class="msg" id="msg-${data.id}"><b>${data.user}</b>`;
            
            if (data.type === 'text') html += `<span>${data.content}</span>`;
            else if (data.type === 'image') html += `<img src="${data.content}">`;
            else if (data.type === 'video') html += `<video controls src="${data.content}"></video>`;
            else html += `<a href="${data.content}" download="${data.filename}" style="color:#6ab3f3">üìÅ ${data.filename}</a>`;
            
            html += `<span class="del-btn" onclick="deleteMsg('${data.id}')">–£–¥–∞–ª–∏—Ç—å</span></div>`;
            chat.innerHTML += html;
            chat.scrollTop = chat.scrollHeight;
        });

        function deleteMsg(id) { socket.emit('delete_msg', id); }
        socket.on('remove_from_ui', function(id) {
            const el = document.getElementById('msg-' + id);
            if(el) el.remove();
        });
    </script>
</body>
</html>
