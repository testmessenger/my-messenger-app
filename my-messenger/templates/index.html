<!DOCTYPE html>
<html>
<head>
    <title>Messenger 2.0</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <style>
        :root { --bg: #0e1621; --surface: #17212b; --text: white; --primary: #6ab3f3; }
        .light-mode { --bg: #ffffff; --surface: #f0f0f0; --text: #000000; --primary: #0088cc; }
        
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; transition: 0.3s; }
        #auth-screen { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; padding: 20px; }
        input { background: var(--surface); border: 1px solid #333; color: var(--text); padding: 12px; border-radius: 8px; margin: 5px; width: 80%; max-width: 300px; }
        
        #main-container { display: none; height: 100vh; flex-direction: column; }
        #sidebar { background: var(--surface); padding: 15px; border-bottom: 1px solid #333; display: flex; overflow-x: auto; gap: 10px; }
        .chat-item { background: var(--bg); padding: 8px 15px; border-radius: 20px; border: 1px solid var(--primary); white-space: nowrap; cursor: pointer; }
        
        #chat { flex: 1; overflow-y: auto; padding: 15px; }
        .msg { background: var(--surface); padding: 10px; border-radius: 12px; margin-bottom: 8px; width: fit-content; max-width: 80%; }
        #input-area { background: var(--surface); padding: 15px; display: flex; gap: 10px; }
    </style>
</head>
<body class="">

    <div id="auth-screen">
        <h2>–í—Ö–æ–¥ –≤ Messenger</h2>
        <input type="text" id="reg-name" placeholder="–í–∞—à–µ –∏–º—è">
        <input type="text" id="reg-user" placeholder="@username">
        <input type="password" id="reg-pass" placeholder="Password">
        <button onclick="login()" style="width: 325px; padding: 10px; margin-top: 10px; background: var(--primary); border: none; border-radius: 8px;">–í–æ–π—Ç–∏</button>
    </div>

    <div id="main-container">
        <div id="sidebar">
            </div>
        <div id="chat"></div>
        <div id="input-area">
            <button onclick="toggleTheme()" class="btn-ui">üåì</button>
            <button onclick="createRoom()" class="btn-ui">‚ûï</button>
            <input type="text" id="text-input" style="flex:1" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
            <button onclick="sendText()" style="background:none; border:none; color:var(--primary); font-size: 24px;">‚û§</button>
        </div>
    </div>

    <script>
        const socket = io();
        let currentUser = null;
        let currentRoom = "–û–±—â–∏–π —á–∞—Ç";
        let rooms = [];

        function login() {
            const name = document.getElementById('reg-name').value;
            const user = document.getElementById('reg-user').value;
            if(name && user) {
                currentUser = { name, user };
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('main-container').style.display = 'flex';
                socket.emit('join', { room: currentRoom });
                updateSidebar();
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
        }

        function createRoom() {
            const name = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã/–∫–∞–Ω–∞–ª–∞:");
            if(name) {
                socket.emit('create_room', { name: name, type: 'group', user: currentUser.user });
            }
        }

        socket.on('room_created', function(data) {
            rooms.push(data.name);
            updateSidebar();
        });

        function updateSidebar() {
            const sidebar = document.getElementById('sidebar');
            if(rooms.length === 0) {
                sidebar.innerHTML = "<small style='opacity:0.5'>–ß–∞—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</small>";
                return;
            }
            sidebar.innerHTML = rooms.map(r => `<div class="chat-item" onclick="switchRoom('${r}')">${r}</div>`).join('');
        }

        function switchRoom(name) {
            socket.emit('join', { room: name });
            currentRoom = name;
            document.getElementById('chat').innerHTML = `<i>--- –í—ã –≤–æ—à–ª–∏ –≤ ${name} ---</i>`;
        }

        function sendText() {
            const el = document.getElementById('text-input');
            if(el.value) {
                socket.emit('message', { 
                    user: currentUser.name, 
                    user_at: currentUser.user, 
                    text: el.value, 
                    room: currentRoom 
                });
                el.value = '';
            }
        }

        socket.on('render_message', function(data) {
            const chat = document.getElementById('chat');
            chat.innerHTML += `<div class="msg"><b>${data.user} (${data.user_at})</b><br>${data.text}</div>`;
            chat.scrollTop = chat.scrollHeight;
        });
    </script>
</body>
</html>
